<div class="container">
  <h2>Mes campagnes</h2>

  <!-- Recherche et tri -->
  <div class="actions">
    <input type="text" placeholder="Rechercher par thème, lieu ou participants..." [(ngModel)]="searchTerm" (input)="applyFilter()">
    <button (click)="resetFilters()">Réinitialiser</button>
  </div>

  <!-- Filtres de section -->
  <div class="section-filters">
    <button [class.active]="activeSection === 'all'" (click)="activeSection = 'all'">Toutes</button>
    <button [class.active]="activeSection === 'today'" (click)="activeSection = 'today'">Aujourd'hui</button>
    <button [class.active]="activeSection === 'upcoming'" (click)="activeSection = 'upcoming'">À venir</button>
    <button [class.active]="activeSection === 'past'" (click)="activeSection = 'past'">Passées</button>
  </div>

  <!-- Campagnes d'aujourd'hui -->
  <div class="campagnes-section" *ngIf="activeSection === 'all' || activeSection === 'today'">
    <h3 *ngIf="todayCampagnes.length > 0">Campagnes d'aujourd'hui</h3>
    <div class="cards-container">
      <div class="card" *ngFor="let campagne of todayCampagnes">
        <div class="card-status" [ngClass]="{
          'status-pending': campagne.statut === 'en_attente',
          'status-approved': campagne.statut === 'validee',
          'status-cancelled': campagne.statut === 'annulee'
        }">
          {{ campagne.statut === 'en_attente' ? 'En attente' : 
             campagne.statut === 'validee' ? 'Validée' : 'Annulée' }}
        </div>
        <div class="card-header">
          <div class="card-title">{{ campagne.theme }}</div>
          <div class="card-subtitle">{{ campagne.lieu }}</div>
        </div>
        <div class="card-content">
          <div class="card-info">
            <i class="fas fa-calendar"></i>
            <span>Date:</span> {{ campagne.date_debut | date: 'dd/MM/yyyy' }} - {{ campagne.date_fin | date: 'dd/MM/yyyy' }}
          </div>
          <div class="card-info">
            <i class="fas fa-clock"></i>
            <span>Heure:</span> {{ campagne.Heure_debut }} - {{ campagne.Heure_fin }}
          </div>
          <div class="card-info">
            <i class="fas fa-users"></i>
            <span>Participants:</span> 
            <div class="participants-badge">{{ campagne.participant }}</div>
          </div>
          <div class="card-actions">
            <button class="btn btn-secondary" (click)="editCampagne(campagne)">
              <i class="fas fa-edit"></i> Modifier
            </button>
            <button class="btn btn-success" (click)="validerCampagne(campagne.id)">
              <i class="fas fa-check"></i> Valider
            </button>
            <button class="btn btn-outline" (click)="viewParticipants(campagne.id)">
              <i class="fas fa-users"></i> Participants
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Campagnes à venir -->
  <div class="campagnes-section" *ngIf="activeSection === 'all' || activeSection === 'upcoming'">
    <h3 *ngIf="upcomingCampagnes.length > 0">Campagnes à venir</h3>
    <div class="cards-container">
      <div class="card" *ngFor="let campagne of upcomingCampagnes">
        <div class="card-status" [ngClass]="{
          'status-pending': campagne.statut === 'en_attente',
          'status-approved': campagne.statut === 'validee',
          'status-cancelled': campagne.statut === 'annulee'
        }">
          {{ campagne.statut === 'en_attente' ? 'En attente' : 
             campagne.statut === 'validee' ? 'Validée' : 'Annulée' }}
        </div>
        <div class="card-header">
          <div class="card-title">{{ campagne.theme }}</div>
          <div class="card-subtitle">{{ campagne.lieu }}</div>
        </div>
        <div class="card-content">
          <div class="card-info">
            <i class="fas fa-calendar"></i>
            <span>Date:</span> {{ campagne.date_debut | date: 'dd/MM/yyyy' }} - {{ campagne.date_fin | date: 'dd/MM/yyyy' }}
          </div>
          <div class="card-info">
            <i class="fas fa-clock"></i>
            <span>Heure:</span> {{ campagne.Heure_debut }} - {{ campagne.Heure_fin }}
          </div>
          <div class="card-info">
            <i class="fas fa-users"></i>
            <span>Participants:</span> 
            <div class="participants-badge">{{ campagne.participant }}</div>
          </div>
          <div class="card-actions">
            <button class="btn btn-secondary" (click)="editCampagne(campagne)">
              <i class="fas fa-edit"></i> Modifier
            </button>
            <button class="btn btn-success" (click)="validerCampagne(campagne.id)">
              <i class="fas fa-check"></i> Valider
            </button>
            <button class="btn btn-outline" (click)="viewParticipants(campagne.id)">
              <i class="fas fa-users"></i> Participants
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Campagnes passées -->
  <div class="campagnes-section" *ngIf="activeSection === 'all' || activeSection === 'past'">
    <h3 *ngIf="pastCampagnes.length > 0">Campagnes passées</h3>
    <div class="cards-container">
      <div class="card" *ngFor="let campagne of pastCampagnes">
        <div class="card-status" [ngClass]="{
          'status-pending': campagne.statut === 'en_attente',
          'status-approved': campagne.statut === 'validee',
          'status-cancelled': campagne.statut === 'annulee'
        }">
          {{ campagne.statut === 'en_attente' ? 'En attente' : 
             campagne.statut === 'validee' ? 'Validée' : 'Annulée' }}
        </div>
        <div class="card-header">
          <div class="card-title">{{ campagne.theme }}</div>
          <div class="card-subtitle">{{ campagne.lieu }}</div>
        </div>
        <div class="card-content">
          <div class="card-info">
            <i class="fas fa-calendar"></i>
            <span>Date:</span> {{ campagne.date_debut | date: 'dd/MM/yyyy' }} - {{ campagne.date_fin | date: 'dd/MM/yyyy' }}
          </div>
          <div class="card-info">
            <i class="fas fa-clock"></i>
            <span>Heure:</span> {{ campagne.Heure_debut }} - {{ campagne.Heure_fin }}
          </div>
          <div class="card-info">
            <i class="fas fa-users"></i>
            <span>Participants:</span> 
            <div class="participants-badge">{{ campagne.participant }}</div>
          </div>
          <div class="card-actions">
            <button class="btn btn-secondary" (click)="editCampagne(campagne)">
              <i class="fas fa-edit"></i> Modifier
            </button>
            <button class="btn btn-success" (click)="validerCampagne(campagne.id)">
              <i class="fas fa-check"></i> Valider
            </button>
            <button class="btn btn-outline" (click)="viewParticipants(campagne.id)">
              <i class="fas fa-users"></i> Participants
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Message s'il n'y a pas de campagnes -->
  <div *ngIf="filteredCampagnes.length === 0" class="alert alert-warning">
    Aucune campagne trouvée.
  </div>

  <!-- Formulaire -->
  <div *ngIf="showForm" class="form-section">
    <h3>{{ isEditing ? 'Modifier une campagne' : 'Ajouter une campagne' }}</h3>
    <form [formGroup]="campagneForm" (ngSubmit)="onSubmit()">
      <input type="text" placeholder="Thème" formControlName="theme">
      <textarea placeholder="Description" formControlName="description"></textarea>
      <input type="text" placeholder="Lieu" formControlName="lieu">
      <input type="date" formControlName="date_debut">
      <input type="date" formControlName="date_fin">
      <input type="time" formControlName="Heure_debut">
      <input type="time" formControlName="Heure_fin">
      <input type="number" placeholder="Nombre de participants" formControlName="participant">
      <select formControlName="statut">
        <option value="en_attente">En attente</option>
        <option value="validee">Validée</option>
        <option value="annulee">Annulée</option>
      </select>

      <!-- ID organisateur et structure sont préremplis -->
      <input type="hidden" formControlName="organisateur_id">
      <input type="hidden" formControlName="structure_transfusion_sanguin_id">

      <button type="submit">{{ isEditing ? 'Mettre à jour' : 'Publier' }}</button>
      <button type="button" (click)="cancelForm()">Annuler</button>
    </form>
  </div>

  <!-- Bouton d'ajout flottant -->
  <div class="floating-button" *ngIf="!showForm" (click)="toggleForm()">
    <i class="fas fa-plus"></i>
  </div>
</div>